# Description
This repository contains detailed instructions on how to generate synthetic images using the [stable_diffsuion](https://github.com/Stability-AI/stablediffusion) model from Stability-AI and prompts generated by [ChatGPT 4](https://chat.openai.com/) (GPT-4 was introduced on March 14 2023, by [openAI](https://openai.com/blog/chatgpt)).
## Prompt Generation Instruction

### Instructions for Prompt Generation
The format is inspired by this [link](https://stable-diffusion-art.com/prompt-guide/).
To begin, ensure that you are using the ChatGPT 4 model and enter the following context:

**You:**
```bash
I want to create a dataset that covers a wide range of scenarios using diffusion model, choose prompts that represent different objects, scenes, and lighting conditions. 
Please generate 10 prompts and make it as much detail as you can, also add extra prompt like: 
"detailed depict, professional photo, 
hyperrealistic, full body, 
realistic, highly detailed, sharp focus" to control its realistic extent.
Use your imagination to make it as variant as possible. 
Put these 10 prompts into a list called prompt_list in python3. Here is some examples: 
"A dedicated teacher engaging with their students, using interactive methods to inspire curiosity and foster a love of learning. Capture the passion of the teacher, the attentiveness of the students, and the vibrant atmosphere of the classroom.",
"A mouthwatering image of a gourmet meal featuring a succulent steak and a tender lobster, accompanied by a medley of fresh, seasonal vegetables. Capture the artful presentation, the appetizing colors and textures, and the enticing aroma of the dish.",
"A sunlit scene of a farmer harvesting ripe cabbages and lettuce in their abundant garden, with the fruits of their labor piled high in a nearby basket. Capture the satisfaction of a successful harvest, the vibrant colors of the produce, and the connection between the farmer and the earth.",
"A cozy, candlelit dinner scene featuring a perfectly cooked steak and lobster, with a couple enjoying the intimate atmosphere and each other's company. Capture the romance of the moment, the enticing aroma of the meal, and the warmth of their connection.",
"A picturesque image of a wooden boat docked along a peaceful riverbank, with the sun setting behind the distant mountains. Capture the tranquility of the scene, the intricate details of the boat, and the breathtaking colors of the sky."

```
**ChatGPT:**
```bash
prompt_list = [
"A bustling marketplace filled with vendors selling their colorful fruits, vegetables, and spices, with customers haggling over prices. Capture the dynamic energy, vibrant colors, and the diverse array of textures and aromas. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus.",
"A serene mountain landscape with a crystal-clear lake, surrounded by tall trees and a gentle waterfall. Capture the beauty of nature, the stillness of the water, the depth of the landscape, and the soothing sound of the waterfall. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus.",
... the rest 7 prompts ...
"A lively street performance featuring a group of musicians and dancers entertaining a captivated audience. Capture the joy of the performers, the energy of the music, and the engagement of the crowd. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus."]

```
You may replace the examples with your own ideas, as they serve as a guide to help ChatGPT 4 learn the style of the prompts.

### Generating Additional Prompts with Specific Keywords
Generating diverse datasets using a single query was attempted, but it was found to be unfeasible as GPT-4 eventually exhausts its creative capacity and produces repetitive prompts. If you wish to generate more prompts that fit your specific keywords, use the following context (The keyword can be replaced to any word): 

**You:**
```bash
I have seen these before, use your imagination and generate 10 more unique prompts, please reference the following keywords: 
"sunset", "beach", "water fight", "coconut".
When you finish, please add the prompts into a List "prompt_list" in python3.
```


**ChatGPT:**
```bash
prompt_list = [
"A breathtaking sunset over a secluded beach, with waves gently lapping against the shore and a warm breeze rustling through the palm trees. Capture the vibrant colors of the sky, the peaceful atmosphere, and the soft textures of the sand. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus.",
"A group of friends enjoying a spirited water fight on a sunny beach, armed with water guns and balloons. Capture the excitement, laughter, and camaraderie, as well as the sparkling water droplets in the air. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus.",
... the rest 7 prompts ...
"A diverse group of people practicing beach yoga at sunset, their poses silhouetted against the vibrant colors of the sky. Capture the tranquility of the scene, the focus of the participants, and the connection to nature. Include detailed depict, professional photo, hyperrealistic, full body, realistic, highly detailed, and sharp focus."
]
```

Ideally, the number of keywords should be at least **4**. ChatGPT 4 will learn from the keywords and generate detailed prompts based on the pattern you provided in the previous step. 

Please note that although GPT 4 is powerful, it might still lose the information of the previous context after many rounds of generations. Please keep monitoring the generating process, when you think the quality of the prompt started to decrease, just input the begin context again to remind it.

### Prompts documentation
This [link](https://docs.google.com/document/d/1cyjlWTom3U2-AbJfjuCILe_MPa1JXwxdz90z6r49Kes/edit?usp=sharing) stores the prompts we used in the previous procedure to generate synthetic images for holography dataset. If you want to access to the JSON file, click [here](https://drive.google.com/file/d/1uNUx_kePduC4MsQ_k019xjBcMujwEEGd/view?usp=share_link).


## Configuring Stable Diffusion
For more information on installing the environment and network, refer to this [link](https://github.com/Stability-AI/stablediffusion#reference-sampling-script).

You may choose your preferred weights to run the model. The weights we used is [v2-1_512-ema-pruned.ckpt](https://huggingface.co/stabilityai/stable-diffusion-2-1-base/blob/main/v2-1_512-ema-pruned.ckpt). 
We use [txt2img](https://github.com/Stability-AI/stablediffusion/blob/main/scripts/txt2img.py) feature in the scripts folder. 

In `batch_txt2img.py`, you can run a series of `python txt2img.py --ckpt checkpoints/v2-1_512-ema-pruned.ckpt --prompt "example prompt"` commands to improve efficiency. You may place the prompts generated from the ChatGPT 4 into the `prompt_list` in the file. 

The default setting is `python3 scripts/txt2img.py --prompt "a professional photograph of an astronaut riding a horse" --ckpt weights/v2-1_512-ema-pruned.ckpt --config configs/stable-diffusion/v2-inference.yaml --H 512 --W 512  --device cuda`


### Depth estimation
Like stable diffusion, we use the [MiDaS](https://github.com/isl-org/MiDaS) to estimate the depth of the images, the [depth2img.py](https://github.com/Stability-AI/stablediffusion/blob/main/scripts/gradio/depth2img.py) integrate `MiDaS` and with their network together.
However, since we only need the depth images, you can use the `midas_only.py` script to only save the depth of your images without generating extra images from the prompts. The weights we used is [dpt_hybrid MiDaS model weights](https://github.com/Stability-AI/stablediffusion#depth-conditional-stable-diffusion) in stablediffusion.

### High resolution data
Kindly note that the stablediffusion v2 generates images with a resolution of 512x512. However, due to the constraints imposed by the available RAM and model, it is not possible to produce images with higher resolutions such as 2k or beyond. Therefore, we have utilized the image reconstruction functionality of [Real-ESRGAN](https://github.com/xinntao/Real-ESRGAN) to scale up the data from 512x512 to 2048x2048 in order to fulfill our requirements. Furthermore, to scale the estimated depth, we have employed the nn.Upsample approach.

